# -----------------------------------------------------
# å–µå–µå®æˆ˜å®¤ï¼šOpenAI TTS è¯­éŸ³åˆæˆå™¨
# -----------------------------------------------------

# å¯¼å…¥openaiåº“ï¼Œæˆ‘ä»¬æœªæ¥å¼ºå¤§çš„AIèƒ½åŠ›éƒ½æ¥è‡ªäºå®ƒ
from openai import OpenAI
# å¯¼å…¥Pathåº“ï¼Œç”¨äºä¼˜é›…åœ°å¤„ç†æ–‡ä»¶è·¯å¾„
from pathlib import Path

# --- æ ¸å¿ƒé…ç½® ---
# 1. åˆå§‹åŒ–OpenAIå®¢æˆ·ç«¯
#    å› ä¸ºæˆ‘ä»¬å·²ç»è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥è¿™é‡Œæ— éœ€å†ä¼ å…¥api_keyå‚æ•°
#    å¦‚æœæ²¡è®¾ç½®ä½¿ç”¨æ³¨é‡Šæ–¹æ³•è°ƒç”¨

# client = OpenAI(base_url="https://apikfm.com/v1",api_key="sk-xxxxxx") # ä½¿ç”¨ å¼€å‘å–µAPI éœ€è¦å¯ä»¥è”ç³»æˆ‘
client = OpenAI()
# 2. å®šä¹‰ä½ æƒ³è®©AIæœ—è¯»çš„æ–‡æœ¬å†…å®¹
# è¯»å–æ•´ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å†…å®¹
try:
    with open('article.txt', 'r', encoding='utf-8') as f:
        text_to_speak = f.read()
except FileNotFoundError:
    print("é”™è¯¯ï¼šè¯·ç¡®ä¿è„šæœ¬æ—è¾¹æœ‰åä¸º article.txt çš„æ–‡ä»¶ï¼")
    exit()


# 3. å®šä¹‰ä¿å­˜éŸ³é¢‘çš„æ–‡ä»¶è·¯å¾„
#    Path(__file__).parent ä¼šè·å–å½“å‰è„šæœ¬æ‰€åœ¨çš„ç›®å½•
#    ç„¶åæˆ‘ä»¬ç”¨ / æ“ä½œç¬¦æ¥æ‹¼æ¥æ–‡ä»¶åï¼Œè¿™æ¯”ç”¨å­—ç¬¦ä¸²"+"æ›´å®‰å…¨ã€æ›´ä¼˜é›…
speech_file_path = Path(__file__).parent / "article_audio.mp3"

# --- å¼€å§‹è¯­éŸ³åˆæˆ ---
print(f"å‡†å¤‡æœ—è¯»çš„æ–‡æœ¬: {text_to_speak}")
print("æ­£åœ¨è¯·æ±‚OpenAIç”Ÿæˆè¯­éŸ³ï¼Œè¯·ç¨å€™...")

# 4. è°ƒç”¨OpenAIçš„è¯­éŸ³åˆæˆAPIï¼Œè¿™æ˜¯æœ€æ ¸å¿ƒçš„ä¸€æ­¥
response = client.audio.speech.create(
    # model: æ¨¡å‹é€‰æ‹©ï¼Œ'tts-1'é€Ÿåº¦æ›´å¿«ï¼Œ'tts-1-hd'è´¨é‡æ›´é«˜æ›´æ¸…æ™°
    model="tts-1-hd",
    
    # voice: å£°éŸ³é€‰æ‹©ï¼Œå…±6ç§ï¼Œæ¯ä¸€ç§éƒ½å¾ˆæœ‰ç‰¹è‰²
    # alloy, echo, fable, onyx, nova, shimmer
    voice="nova",
    
    # input: æˆ‘ä»¬è¦è½¬æ¢çš„æ–‡æœ¬
    input=text_to_speak
)

# 5. å°†APIè¿”å›çš„éŸ³é¢‘æµï¼Œç›´æ¥ä¿å­˜åˆ°æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶ä¸­
#    stream_to_fileæ˜¯å®˜æ–¹æ¨èçš„ç”¨æ³•ï¼Œå®ƒä¼šé«˜æ•ˆåœ°å¤„ç†æ•°æ®æµ
response.stream_to_file(speech_file_path)

print(f"ğŸ‰ è¯­éŸ³ç”ŸæˆæˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜åˆ°: {speech_file_path}")